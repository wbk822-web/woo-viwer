name: Build SegyViewer EXE 2026

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      # geopandas 설치 시 의존성 문제가 종종 발생하므로 미리 wheel 등을 설치하거나 순서를 지키는 것이 좋습니다.
      # windows 환경에서 geopandas는 pip로 직접 설치가 까다로울 수 있으나, github runner 환경에서는 보통 잘 됩니다.
      run: |
        python -m pip install --upgrade pip
        pip install numpy segyio matplotlib scipy requests PySide6 geopandas shapely

    - name: Build with PyInstaller
      # --hidden-import 옵션은 PyInstaller가 자동으로 찾지 못하는 모듈을 수동으로 포함시킵니다.
      # geopandas와 matplotlib의 숨겨진 의존성을 명시해 주는 것이 안전합니다.
      run: |
        pyinstaller --noconsole --onefile --clean `
        --hidden-import=scipy.spatial.transform._rotation_groups `
        --hidden-import=mpl_toolkits.axes_grid1 `
        --hidden-import=geopandas.datasets `
        --hidden-import=fiona `
        --hidden-import=shapely `
        --collect-all geopandas `
        --collect-all pyproj `
        --name "SegyViewer" main.py

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: SegyViewer_EXE
        path: dist/SegyViewer.exe
        retention-days: 5
